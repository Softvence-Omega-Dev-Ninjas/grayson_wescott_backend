<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat Test</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
  <h1>Chat Test Page</h1>

  <div>
    <label>
      Role:
      <select id="role">
        <option value="client">Client</option>
        <option value="admin">Admin</option>
      </select>
    </label>
    <br>
    <label>
      Token:
      <input type="text" id="token" placeholder="Paste JWT here" size="60" />
    </label>
    <br>
    <button id="connectBtn">Connect</button>
  </div>

  <hr>

  <div>
    <textarea id="messageInput" rows="3" cols="50" placeholder="Type a message..."></textarea><br>
    <button id="sendBtn">Send Message</button>
  </div>

  <hr>

  <div>
    <h3>Logs</h3>
    <pre id="logs"></pre>
  </div>

  <script>
    let socket;

    const log = (msg, data) => {
      const logs = document.getElementById("logs");
      logs.textContent += msg + (data ? " " + JSON.stringify(data) : "") + "\n";
    };

    document.getElementById("connectBtn").onclick = () => {
      const token = document.getElementById("token").value.trim();
      const role = document.getElementById("role").value;

      if (!token) {
        alert("Please enter JWT token");
        return;
      }

      // connect
      socket = io("http://localhost:5010/api/chat", {
        extraHeaders: { Authorization: "Bearer " + token },
      });

      socket.on("connect", () => log("Connected as " + role));
      socket.on("disconnect", () => log("Disconnected"));
      socket.on("private:success", (data) => log("SUCCESS:", data));
      socket.on("private:error", (data) => log("ERROR:", data));
      socket.on("private:new_message", (data) => log("NEW_MESSAGE:", data));
    };

    document.getElementById("sendBtn").onclick = () => {
      if (!socket || !socket.connected) {
        alert("Not connected!");
        return;
      }
      const role = document.getElementById("role").value;
      const content = document.getElementById("messageInput").value.trim();

      if (!content) {
        alert("Please type a message");
        return;
      }

      if (role === "client") {
        socket.emit("private:send_message_client", {
          content,
          type: "TEXT",
        });
        log("Sent CLIENT message:", { content });
      } else {
        socket.emit("private:send_message_admin", {
          clientId: "e5023b82-5f18-49d7-8e7b-6df0f6be2978", 
          content,
          type: "TEXT",
        });
        log("Sent ADMIN message:", { content });
      }
    };
  </script>
</body>
</html>
